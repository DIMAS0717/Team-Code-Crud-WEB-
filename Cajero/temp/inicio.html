<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Coffee Shop</title>
  <link rel="stylesheet" href="inicio.css">
</head>
<body>
<div class="container">
  <aside class="sidebar">
    <div class="logo">
      <svg width="36" height="36" viewBox="0 0 36 36"><circle cx="18" cy="18" r="18" fill="#fff"/><rect x="8" y="14" width="20" height="8" rx="4" fill="#c68644"/></svg>
      <h2>COFFEE SHOP</h2>
    </div>
    <nav class="nav">
      <a href="#" class="nav-link">
        <span class="icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12L12 3l9 9"/><path d="M9 21V9h6v12"/></svg></span>
        <span class="nav-text">Inicio</span>
      </a>
      <a href="#" class="nav-link active">
        <span class="icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M16 3v4M8 3v4"/></svg></span>
        <span class="nav-text">Productos</span>
      </a>
      <a href="#" class="nav-link">
        <span class="icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="7" cy="17" r="2"/><circle cx="17" cy="7" r="2"/><path d="M7 17L17 7"/></svg></span>
        <span class="nav-text">Promociones</span>
      </a>
      <a href="../ControlCaja/controlcaja.html" class="nav-link">
        <span class="icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span>
        <span class="nav-text">Control</span>
      </a>
      <a href="#" class="nav-link">
        <span class="icon"><svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a8.38 8.38 0 0 1 13 0"/></svg></span>
        <span class="nav-text">Admin</span>
      </a>
    </nav>
  </aside>

  <main class="main">
    <div class="main-scroll">
      <header class="header">
        <h1>Coffee Shop</h1>
        <div class="date">Jueves, 25 de septiembre de 2025</div>
      </header>
      <section class="filters">
        <input class="search" type="search" placeholder="Buscar..." />
        <div class="cats">
          <button class="cat-btn">Frappes</button>
          <button class="cat-btn active">Cafés</button>
          <button class="cat-btn">Comida</button>
          <button class="cat-btn">Postres</button>
          <button class="cat-btn">Panes</button>
        </div>
      </section>
      
      <section class="products" aria-label="Productos">
        <article class="product-card-new" data-name="Café Americano" data-desc="Café caliente tradicional">
          <div class="card-top">
            <span class="card-tag">CALIENTE</span>
            <span class="card-price">$39.50</span>
          </div>
          <div class="card-image">
            <img src="../img/amer.png" alt="Café Americano"> 
          </div>
          <div class="card-options">
            <div class="option-select">
              <select class="milk-type">
                <option selected disabled>Tipo Leche</option>
                <option>Entera</option>
                <option>Deslactosada</option>
                <option>Almendra</option>
              </select>
            </div>
            <div class="option-select">
              <select class="coffee-type">
                <option selected disabled>Tipo Café</option>
                <option>Grano regular</option>
                <option>Descafeinado</option>
              </select>
            </div>
            <div class="option-row quantity-selector">
              <button class="quantity-btn minus">-</button>
              <span class="quantity-value">1</span>
              <button class="quantity-btn plus">+</button>
            </div>
            <div class="option-row size-selector">
              <button class="size-btn active" data-price="39.50">
                <svg viewBox="0 0 24 24"><path d="M4 10h16v10a2 2 0 01-2 2H6a2 2 0 01-2-2v-10zm2-4h12v2H6V6z"/></svg>
                <span>250ML</span>
              </button>
              <button class="size-btn" data-price="45.00">
                <svg viewBox="0 0 24 24"><path d="M3 8h18v10a3 3 0 01-3 3H6a3 3 0 01-3-3V8zm3-4h12v2H6V4z"/></svg>
                <span>500ML</span>
              </button>
              <button class="size-btn" data-price="52.00">
                <svg viewBox="0 0 24 24"><path d="M2 7h20v10a4 4 0 01-4 4H6a4 4 0 01-4-4V7zm4-4h12v2H6V3z"/></svg>
                <span>1L</span>
              </button>
            </div>
          </div>
          <textarea class="extra-requests-input" placeholder="Peticiones extras..."></textarea>
          <button class="add-to-cart-btn">Añadir a Carrito</button>
        </article>

        <article class="product-card-new" data-name="Latte Helado" data-desc="Bebida fría y cremosa">
          <div class="card-top">
            <span class="card-tag" style="background-color: #5c9ed6;">FRÍO</span>
            <span class="card-price">$48.00</span>
          </div>
          <div class="card-image">
            <img src="../img/latte.png" alt="Latte Helado">
          </div>
          <div class="card-options">
            <div class="option-select">
              <select class="milk-type">
                <option selected disabled>Tipo Leche</option>
                <option>Entera</option>
                <option>Deslactosada</option>
                <option>Almendra</option>
              </select>
            </div>
            <div class="option-select">
              <select class="coffee-type">
                <option selected disabled>Tipo Café</option>
                <option>Grano regular</option>
                <option>Descafeinado</option>
              </select>
            </div>
            <div class="option-row quantity-selector">
              <button class="quantity-btn minus">-</button>
              <span class="quantity-value">1</span>
              <button class="quantity-btn plus">+</button>
            </div>
            <div class="option-row size-selector">
              <button class="size-btn active" data-price="48.00">
                <svg viewBox="0 0 24 24"><path d="M4 10h16v10a2 2 0 01-2 2H6a2 2 0 01-2-2v-10zm2-4h12v2H6V6z"/></svg>
                <span>250ML</span>
              </button>
              <button class="size-btn" data-price="55.50">
                <svg viewBox="0 0 24 24"><path d="M3 8h18v10a3 3 0 01-3 3H6a3 3 0 01-3-3V8zm3-4h12v2H6V4z"/></svg>
                <span>500ML</span>
              </button>
              <button class="size-btn" data-price="64.00">
                <svg viewBox="0 0 24 24"><path d="M2 7h20v10a4 4 0 01-4 4H6a4 4 0 01-4-4V7zm4-4h12v2H6V3z"/></svg>
                <span>1L</span>
              </button>
            </div>
          </div>
          <textarea class="extra-requests-input" placeholder="Peticiones extras..."></textarea>
          <button class="add-to-cart-btn">Añadir a Carrito</button>
        </article>
      </section>
    </div>
  </main>

  <aside class="cart">
    <div class="order-pill">
      <div class="order-title">Número de Pedido</div>
      <div class="order-number">901</div>
    </div>
    <div class="cart-content"></div>
    <div class="cart-bottom">
      <div class="summary">
        <div class="row"><span>Sub Total:</span> <span class="summary-subtotal">$0.00</span></div>
        <div class="row"><span>IVA:</span> <span class="summary-iva">$0.00</span></div>
        <div class="row total"><span>Total:</span> <span class="summary-total">$0.00</span></div>
      </div>
      <button class="pay">PAGAR</button>
    </div>
  </aside>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const cartList = [];
  const cartContent = document.querySelector('.cart-content');
  const summarySubtotal = document.querySelector('.summary-subtotal');
  const summaryIVA = document.querySelector('.summary-iva');
  const summaryTotal = document.querySelector('.summary-total');

  function renderCart() {
    cartContent.innerHTML = '';
    let subtotal = 0;
    
    cartList.forEach((item, idx) => {
      subtotal += item.price * item.qty;
      const div = document.createElement('div');
      div.className = 'cart-item';
      
      let optionsDesc = `${item.milk}, ${item.coffee}, ${item.size}`;
      if (item.requests) {
          optionsDesc += ` (${item.requests})`;
      }

      div.innerHTML = `
        <div class="cart-thumb"><img src="${item.imgSrc}" alt="${item.name}"></div>
        <div class="cart-info">
          <div class="cart-title">${item.name}</div>
          <div class="cart-desc">${optionsDesc}</div>
          <div class="cart-price">$${item.price.toFixed(2)}</div>
        </div>
        <div class="cart-qty">
          <button class="qty-btn-cart" data-idx="${idx}" data-action="minus">-</button>
          <div class="qty-num">${item.qty.toString().padStart(2, '0')}</div>
          <button class="qty-btn-cart" data-idx="${idx}" data-action="plus">+</button>
        </div>
      `;
      cartContent.appendChild(div);
    });

    summarySubtotal.textContent = `$${subtotal.toFixed(2)}`;
    const iva = subtotal * 0.16;
    summaryIVA.textContent = `$${iva.toFixed(2)}`;
    summaryTotal.textContent = `$${(subtotal + iva).toFixed(2)}`;
  }

  cartContent.addEventListener('click', e => {
    if (e.target.classList.contains('qty-btn-cart')) {
      const idx = parseInt(e.target.dataset.idx);
      const action = e.target.dataset.action;

      if (action === 'plus') {
        cartList[idx].qty += 1;
      } else if (action === 'minus') {
        cartList[idx].qty -= 1;
        if (cartList[idx].qty <= 0) {
          cartList.splice(idx, 1);
        }
      }
      renderCart();
    }
  });

  function getProductDataFromCard(card) {
    const milkSelect = card.querySelector('.milk-type');
    const coffeeSelect = card.querySelector('.coffee-type');
    
    if (milkSelect.selectedIndex === 0) {
        alert('Por favor, selecciona un tipo de leche.');
        return null;
    }
    if (coffeeSelect.selectedIndex === 0) {
        alert('Por favor, selecciona un tipo de café.');
        return null;
    }
      
    // 👇 NOTA: Ahora el precio que se lee es el total, NO el unitario.
    // Lo corregiremos al añadir al carrito.
    return {
      name: card.dataset.name,
      desc: card.dataset.desc,
      price: parseFloat(card.querySelector('.card-price').textContent.replace('$', '')),
      imgSrc: card.querySelector('.card-image img').src,
      qty: parseInt(card.querySelector('.quantity-value').textContent),
      milk: milkSelect.value,
      coffee: coffeeSelect.value,
      size: card.querySelector('.size-btn.active span').textContent,
      requests: card.querySelector('.extra-requests-input').value.trim()
    };
  }
  
  const allCards = document.querySelectorAll('.product-card-new');
  allCards.forEach(card => {
    
    const plusBtn = card.querySelector('.quantity-btn.plus');
    const minusBtn = card.querySelector('.quantity-btn.minus');
    const valueSpan = card.querySelector('.quantity-value');
    const sizeButtons = card.querySelectorAll('.size-btn');
    const addToCartButton = card.querySelector('.add-to-cart-btn');
    const priceDisplay = card.querySelector('.card-price');
    
    // --- ✅ NUEVA FUNCIÓN PARA ACTUALIZAR EL PRECIO TOTAL EN LA TARJETA ---
    function updateTotalPrice() {
      const quantity = parseInt(valueSpan.textContent);
      const activeSizeButton = card.querySelector('.size-btn.active');
      const unitPrice = parseFloat(activeSizeButton.dataset.price);
      
      const totalPrice = unitPrice * quantity;
      priceDisplay.textContent = `$${totalPrice.toFixed(2)}`;
    }

    // Inicializa el precio al cargar la página
    updateTotalPrice(); 
    
    plusBtn.addEventListener('click', () => {
      valueSpan.textContent = parseInt(valueSpan.textContent) + 1;
      updateTotalPrice(); // ✅ Actualiza el precio al sumar
    });

    minusBtn.addEventListener('click', () => {
      let currentValue = parseInt(valueSpan.textContent);
      if (currentValue > 1) {
        valueSpan.textContent = currentValue - 1;
        updateTotalPrice(); // ✅ Actualiza el precio al restar
      }
    });

    sizeButtons.forEach(button => {
      button.addEventListener('click', () => {
        card.querySelectorAll('.size-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        updateTotalPrice(); // ✅ Actualiza el precio al cambiar de tamaño
      });
    });

    addToCartButton.addEventListener('click', () => {
      const productData = getProductDataFromCard(card);
      if (!productData) return;

      // ✅ CORRECCIÓN: Al añadir al carrito, usamos el precio unitario, no el total
      const unitPrice = parseFloat(card.querySelector('.size-btn.active').dataset.price);
      productData.price = unitPrice;


      const existingProductIndex = cartList.findIndex(item => 
        item.name === productData.name &&
        item.milk === productData.milk &&
        item.coffee === productData.coffee &&
        item.size === productData.size &&
        item.requests === productData.requests
      );

      if (existingProductIndex > -1) {
        cartList[existingProductIndex].qty += productData.qty;
      } else {
        cartList.push(productData);
      }
      
      renderCart();
    });
  });

  renderCart();
});
</script>
</body>
</html>